<script setup>
/*--------------------------------------------------------------------------------------------------------------------*/

import { inject } from 'vue';

/*--------------------------------------------------------------------------------------------------------------------*/
/* VARIABLES                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const indi = inject('indi');
const sock = inject('sock');

/*--------------------------------------------------------------------------------------------------------------------*/

const props = defineProps({
    defTextVector: {
        type: Object,
        default: {},
    },
});

/*--------------------------------------------------------------------------------------------------------------------*/

const colors = {
    'Idle': 'secondary',
    'Ok': 'primary',
    'Busy': 'warning',
    'Alert': 'danger',
};

/*--------------------------------------------------------------------------------------------------------------------*/
/* FUNCTIONS                                                                                                          */
/*--------------------------------------------------------------------------------------------------------------------*/

const sendMessage = () => {

    const message = indi.buildNewTextVectorMessage(props.defTextVector);

    if(message)
    {
        sock.emit('indi', message);
    }
};

/*--------------------------------------------------------------------------------------------------------------------*/
</script>

<template>

    <!-- *********************************************************************************************************** -->

    <div class="row">

        <!-- ******************************************************************************************************* -->

        <label class="col-sm-2">
            <span :class="`text-${colors[defTextVector['@state']]}`">
                <i class="bi bi-circle-fill"></i>
            </span>
            {{ defTextVector['@label'] || defTextVector['@name'] }}
        </label>

        <!-- ******************************************************************************************************* -->

        <div :class="{'col-sm-10': defTextVector['@perm'] === 'ro', 'col-sm-9': defTextVector['@perm'] !== 'ro'}">

            <template v-for="defText in defTextVector['children']">

                <div class="input-group input-group-sm mb-1">

                    <span class="input-group-text" style="min-width: 175px;">
                        {{ defText['@label'] || defText['@name'] }}
                    </span>

                    <input class="form-control" type="text" :readonly="defTextVector['@perm'] === 'ro'" v-model="defText['$']" />

                </div>

            </template>

        </div>

        <!-- ******************************************************************************************************* -->

        <div class="col-sm-1 pb-1" v-if="defTextVector['@perm'] !== 'ro'">

            <button class="btn btn-xs btn-outline-primary h-100 w-100" @click="sendMessage()">
                Apply
            </button>

        </div>

        <!-- ******************************************************************************************************* -->

    </div>

    <!-- *********************************************************************************************************** -->

</template>
